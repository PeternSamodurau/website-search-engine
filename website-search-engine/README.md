# Spring Boot News Portal with Spring Security

Проект новостного портала, разработанный на Spring Boot.

## Технологии

*   **Java 17**
*   **Spring Boot 3**
*   **Spring Security** (для аутентификации и авторизации)
*   **Spring Data JPA** (для работы с базой данных)
*   **PostgreSQL** (в качестве основной базы данных)
*   **Lombok** (для сокращения шаблонного кода)
*   **MapStruct** (для маппинга DTO)
*   **Docker & Docker Compose** (для контейнеризации и развертывания)
*   **Swagger (OpenAPI)** (для документирования и тестирования API)
*   **Spring AOP** (для реализации аспекта проверки прав доступа)

## Роли пользователей

В системе предусмотрены три роли:

1.  `ROLE_USER` - Обычный пользователь. Может просматривать и редактировать **только свои** данные.
2.  `ROLE_MODERATOR` - Модератор. Может просматривать всех пользователей, создавать новых, а также редактировать и удалять **любого** пользователя, кроме администраторов.
3.  `ROLE_ADMIN` - Администратор. Обладает полными правами на управление пользователями.

## Запуск проекта

1.  Убедитесь, что у вас установлен Docker и Docker Compose.
2.  Склонируйте репозиторий.
3.  В корневой директории проекта выполните команду:
    ```bash
    .\docker\docker-start.cmd
    ```
4.  Приложение будет доступно по адресу `http://localhost:8081`.
5.  Документация Swagger UI доступна по адресу [http://localhost:8081/swagger-ui.html](http://localhost:8081/swagger-ui.html).

## Тестирование API через Swagger UI

Для тестирования необходимо авторизоваться в Swagger UI, нажав на кнопку "Authorize" и введя логин и пароль одного из тестовых пользователей.

### Тестовые пользователи

| Логин       | Пароль      | Роль             | ID  |
|:------------|:------------|:-----------------|:----|
| `admin`     | `admin`     | `ROLE_ADMIN`     | 4   |
| `moderator` | `moderator` | `ROLE_MODERATOR` | 3   |
| `user1`     | `password1` | `ROLE_USER`      | 1   |
| `user2`     | `password2` | `ROLE_USER`      | 2   |

---

### Сценарии тестирования для `UserController` (`/api/v1/users`)

#### 1. Роль: `ROLE_USER` (user1 / password1, ID=1)

| Эндпоинт                 | Действие                                 | Ожидаемый результат (Статус)  | Примечание                    |
|:-------------------------|:-----------------------------------------|:------------------------------|:------------------------------|
| **`POST /users`**        | **(Негативный)** Создание пользователя   | `403 Forbidden`               |                               |
| **`GET /users`**         | **(Негативный)** Получение всех          | `403 Forbidden`               |                               |
| **`GET /users/1`**       | **(Позитивный)** Получение своих данных  | `200 OK`                      |                               |
| **`GET /users/2`**       | **(Негативный)** Получение чужих данных  | `403 Forbidden`               |                               |
| **`PUT /users/1`**       | **(Позитивный)** Обновление своих данных | `200 OK`                      | новый пароль и имя и почта!!! |
| **`PUT /users/2`**       | **(Негативный)** Обновление чужих данных | `403 Forbidden`               |                               |
| **`DELETE /users/1`**    | **(Позитивный)** Удаление своего профиля | `204 No Content`              |                               |
| **`DELETE /users/2`**    | **(Негативный)** Удаление чужого профиля | `403 Forbidden`               |                               |

---

#### 2. Роль: `ROLE_MODERATOR` (moderator / moderator, ID=3)

| Эндпоинт                 | Действие                                   | Ожидаемый результат (Статус) | Примечание                                                     |
|:-------------------------|:-------------------------------------------|:-----------------------------|:---------------------------------------------------------------|
| **`POST /users`**        | **(Позитивный)** Создание пользователя     | `201 Created`                |                                                                |
| **`GET /users`**         | **(Негативный)** Получение всех            | `403 Forbidden`              | **Только ADMIN может получить всех**                           |
| **`GET /users/1`**       | **(Позитивный)** Получение данных `user1`  | `200 OK`                     |                                                                |
| **`PUT /users/1`**       | **(Позитивный)** Обновление данных `user1` | `200 OK`                     |                                                                |
| **`DELETE /users/1`**    | **(Позитивный)** Удаление `user1`          | `204 No Content`             |                                                                |
| **`GET /users/4`**       | **(Негативный)** Получение админа          | `403 Forbidden`              | Модератор не может трогать админа                              |
| **`PUT /users/4`**       | **(Негативный)** Обновление админа         | `403 Forbidden`              | Модератор не может трогать админа                              |
| **`DELETE /users/4`**    | **(Негативный)** Удаление админа           | `403 Forbidden`              | Модератор не может трогать админа                              |

---

#### 3. Роль: `ROLE_ADMIN` (admin / admin, ID=4)

| Эндпоинт              | Действие                                | Ожидаемый результат (Статус) | Примечание |
|:----------------------|:----------------------------------------|:-----------------------------|:-----------|
| **`POST /users`**     | **(Позитивный)** Создание пользователя  | `201 Created`                |            |
| **`GET /users`**      | **(Позитивный)** Получение всех         | `200 OK`                     |            |
| **`GET /users/1`**    | **(Позитивный)** Получение `user1`      | `200 OK`                     |            |
| **`PUT /users/1`**    | **(Позитивный)** Обновление `user1`     | `200 OK`                     |            |
| **`DELETE /users/1`** | **(Позитивный)** Удаление `user1`       | `204 No Content`             |            |
| **`GET /users/3`**    | **(Позитивный)** Получение `moderator`  | `200 OK`                     |            |
| **`PUT /users/3`**    | **(Позитивный)** Обновление `moderator` | `200 OK`                     |            |
| **`DELETE /users/3`** | **(Позитивный)** Удаление `moderator`   | `204 No Content`             |            |

---

### Сценарии тестирования для `CategoryController` (`/api/v1/categories`)

#### 1. Роль: `ROLE_USER` (user1 / password1, ID=1)

| Эндпоинт                      | Действие                                   | Ожидаемый результат (Статус) | Примечание                                                                               |
|:------------------------------|:-------------------------------------------|:-----------------------------|:-----------------------------------------------------------------------------------------|
| **`GET /categories`**         | **(Позитивный)** Получение всех категорий  | `200 OK`                     |                                                                                          |
| **`GET /categories/{id}`**    | **(Позитивный)** Получение категории по ID | `200 OK`                     | Использовать существующий ID категории                                                   |
| **`POST /categories`**        | **(Негативный)** Создание категории        | `403 Forbidden`              | Request Body: `{"categoryName": "User Category"}`                                        |
| **`PUT /categories/{id}`**    | **(Негативный)** Обновление категории      | `403 Forbidden`              | Использовать существующий ID категории. Request Body: `{"categoryName": "User Updated Category"}` |
| **`DELETE /categories/{id}`** | **(Негативный)** Удаление категории        | `403 Forbidden`              | Использовать существующий ID категории                                                   |

---

#### 2. Роль: `ROLE_MODERATOR` (moderator / moderator, ID=3)

| Эндпоинт                      | Действие                                    | Ожидаемый результат (Статус) | Примечание                                                                                   |
|:------------------------------|:--------------------------------------------|:-----------------------------|:---------------------------------------------------------------------------------------------|
| **`GET /categories`**         | **(Позитивный)** Получение всех категорий   | `200 OK`                     |                                                                                              |
| **`GET /categories/{id}`**    | **(Позитивный)** Получение категории по ID  | `200 OK`                     | Использовать существующий ID категории                                                       |
| **`POST /categories`**        | **(Позитивный)** Создание категории         | `201 Created`                | Request Body: `{"categoryName": "Moderator Category"}`                                       |
| **`PUT /categories/{id}`**    | **(Позитивный)** Обновление категории       | `200 OK`                     | Использовать существующий ID категории. Request Body: `{"categoryName": "Moderator Updated Category"}` |
| **`DELETE /categories/{id}`** | **(Позитивный)** Удаление категории         | `204 No Content`             | Использовать существующий ID категории                                                       |

---

#### 3. Роль: `ROLE_ADMIN` (admin / admin, ID=4)

| Эндпоинт                      | Действие                                     | Ожидаемый результат (Статус) | Примечание                                                                               |
|:------------------------------|:---------------------------------------------|:-----------------------------|:-----------------------------------------------------------------------------------------|
| **`GET /categories`**         | **(Позитивный)** Получение всех категорий    | `200 OK`                     |                                                                                          |
| **`GET /categories/{id}`**    | **(Позитивный)** Получение категории по ID   | `200 OK`                     | Использовать существующий ID категории                                                   |
| **`POST /categories`**        | **(Позитивный)** Создание категории          | `201 Created`                | Request Body: `{"categoryName": "Admin Category"}`                                       |
| **`PUT /categories/{id}`**    | **(Позитивный)** Обновление категории        | `200 OK`                     | Использовать существующий ID категории. Request Body: `{"categoryName": "Admin Updated Category"}` |
| **`DELETE /categories/{id}`** | **(Позитивный)** Удаление категории          | `204 No Content`             | Использовать существующий ID категории                                                   |

---

### Сценарии тестирования для `CommentController` (`/api/v1/news/{newsId}/comments`)

#### 1. Роль: `ROLE_USER` (user1 / password1, ID=1)

| Эндпоинт                                         | Действие                                                                | Ожидаемый результат (Статус) | Примечание                               |
|:-------------------------------------------------|:------------------------------------------------------------------------|:-----------------------------|:-----------------------------------------|
| **`POST /news/{newsId}/comments`**               | **(Позитивный)** Создание комментария                                   | `201 Created`                |                                          |
| **`GET /news/{newsId}/comments`**                | **(Позитивный)** Получение всех комментариев к новости                  | `200 OK`                     |                                          |
| **`PUT /news/{newsId}/comments/{commentId}`**    | **(Позитивный)** Обновление **своего** комментария                      | `200 OK`                     |                                          |
| **`PUT /news/{newsId}/comments/{commentId}`**    | **(Негативный)** Обновление **чужого** комментария (созданного `user2`) | `403 Forbidden`              | Только автор может обновлять             |
| **`DELETE /news/{newsId}/comments/{commentId}`** | **(Позитивный)** Удаление **своего** комментария                        | `204 No Content`             |                                          |
| **`DELETE /news/{newsId}/comments/{commentId}`** | **(Негативный)** Удаление **чужого** комментария (созданного `user2`)   | `403 Forbidden`              | Только автор, модератор или админ |

---

#### 2. Роль: `ROLE_MODERATOR` (moderator / moderator, ID=3)

| Эндпоинт                                         | Действие                                                                | Ожидаемый результат (Статус) | Примечание                               |
|:-------------------------------------------------|:------------------------------------------------------------------------|:-----------------------------|:-----------------------------------------|
| **`POST /news/{newsId}/comments`**               | **(Позитивный)** Создание комментария                                   | `201 Created`                |                                          |
| **`GET /news/{newsId}/comments`**                | **(Позитивный)** Получение всех комментариев к новости                  | `200 OK`                     |                                          |
| **`PUT /news/{newsId}/comments/{commentId}`**    | **(Негативный)** Обновление **чужого** комментария (созданного `user1`) | `403 Forbidden`              | Только автор может обновлять             |
| **`DELETE /news/{newsId}/comments/{commentId}`** | **(Позитивный)** Удаление **чужого** комментария (созданного `user1`)   | `204 No Content`             | Модератор может удалять любые комментарии |

---

#### 3. Роль: `ROLE_ADMIN` (admin / admin, ID=4)

| Эндпоинт                                         | Действие                                                                | Ожидаемый результат (Статус) | Примечание                           |
|:-------------------------------------------------|:------------------------------------------------------------------------|:-----------------------------|:-------------------------------------|
| **`POST /news/{newsId}/comments`**               | **(Позитивный)** Создание комментария                                   | `201 Created`                |                                      |
| **`GET /news/{newsId}/comments`**                | **(Позитивный)** Получение всех комментариев к новости                  | `200 OK`                     |                                      |
| **`PUT /news/{newsId}/comments/{commentId}`**    | **(Негативный)** Обновление **чужого** комментария (созданного `user1`) | `403 Forbidden`              | Только автор может обновлять         |
| **`DELETE /news/{newsId}/comments/{commentId}`** | **(Позитивный)** Удаление **чужого** комментария (созданного `user1`)   | `204 No Content`             | Админ может удалять любые комментарии |

---

### Сценарии тестирования для `NewsController` (`/api/v1/news`)

#### 1. Роль: `ROLE_USER` (user1 / password1, ID=1)

| Эндпоинт                 | Действие                                                                | Ожидаемый результат (Статус) | Примечание                               |
|:-------------------------|:------------------------------------------------------------------------|:-----------------------------|:-----------------------------------------|
| **`GET /news`**          | **(Позитивный)** Получение всех новостей                                | `200 OK`                     |                                          |
| **`GET /news/{id}`**     | **(Позитивный)** Получение новости по ID                                | `200 OK`                     |                                          |
| **`POST /news`**         | **(Позитивный)** Создание новости                                       | `201 Created`                |                                          |
| **`PUT /news/{id}`**     | **(Позитивный)** Обновление **своей** новости                           | `200 OK`                     |                                          |
| **`PUT /news/{id}`**     | **(Негативный)** Обновление **чужой** новости (созданной `user2`)       | `403 Forbidden`              | Только автор может обновлять             |
| **`DELETE /news/{id}`**  | **(Позитивный)** Удаление **своей** новости                             | `204 No Content`             |                                          |
| **`DELETE /news/{id}`**  | **(Негативный)** Удаление **чужой** новости (созданной `user2`)         | `403 Forbidden`              | Только автор, модератор или админ        |

---

#### 2. Роль: `ROLE_MODERATOR` (moderator / moderator, ID=3)

| Эндпоинт                 | Действие                                                                | Ожидаемый результат (Статус) | Примечание                               |
|:-------------------------|:------------------------------------------------------------------------|:-----------------------------|:-----------------------------------------|
| **`GET /news`**          | **(Позитивный)** Получение всех новостей                                | `200 OK`                     |                                          |
| **`GET /news/{id}`**     | **(Позитивный)** Получение новости по ID                                | `200 OK`                     |                                          |
| **`POST /news`**         | **(Позитивный)** Создание новости                                       | `201 Created`                |                                          |
| **`PUT /news/{id}`**     | **(Негативный)** Обновление **чужой** новости (созданной `user1`)       | `403 Forbidden`              | Только автор может обновлять             |
| **`DELETE /news/{id}`**  | **(Позитивный)** Удаление **чужой** новости (созданной `user1`)         | `204 No Content`             | Модератор может удалять любые новости    |

---

#### 3. Роль: `ROLE_ADMIN` (admin / admin, ID=4)

| Эндпоинт                 | Действие                                                                | Ожидаемый результат (Статус) | Примечание                           |
|:-------------------------|:------------------------------------------------------------------------|:-----------------------------|:-------------------------------------|
| **`GET /news`**          | **(Позитивный)** Получение всех новостей                                | `200 OK`                     |                                      |
| **`GET /news/{id}`**     | **(Позитивный)** Получение новости по ID                                | `200 OK`                     |                                      |
| **`POST /news`**         | **(Позитивный)** Создание новости                                       | `201 Created`                |                                      |
| **`PUT /news/{id}`**     | **(Негативный)** Обновление **чужой** новости (созданной `user1`)       | `403 Forbidden`              | Только автор может обновлять         |
| **`DELETE /news/{id}`**  | **(Позитивный)** Удаление **чужой** новости (созданной `user1`)         | `204 No Content`             | Админ может удалять любые новости    |

---
