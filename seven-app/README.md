# Практическая работа: Трекер задач (Task Tracker) with Spring Security

Приложение для отслеживания задач, разработанное на Spring WebFlux.

## Запуск приложения

1.  Выполните команду:
    
    **.\docker\docker-start.cmd**
    
2.  Выполняется инициализация:
    
    *   AuthorInitializer.java из app.default-author-username=userAuthor и app.default-author-usermail=userAuthor@mail.ru
    *   UserInitializer.java
    *   TaskInitializer.java
    
3.  Откройте Swagger в браузере http://localhost:8080/swagger-ui.html

# Тестирование API через Swagger UI

Для тестирования необходимо авторизоваться в Swagger UI, нажав на кнопку "Authorize" и введя логин и пароль одного из тестовых пользователей.

### Тестовые пользователи

| Логин     | Пароль    | Роли           |
|:----------|:----------|:---------------|
| `manager` | `manager` | `ROLE_MANAGER` |
| `user1`   | `user1`   | `ROLE_USER`    |
| `user2`   | `user2`   | `ROLE_USER`    |
| `user3`   | `user3`   | `ROLE_USER`    |
| `user4`   | `user4`   | `ROLE_USER`    |
| `user5`   | `user5`   | `ROLE_USER`    |

---

### Сценарии тестирования для `TaskController` (`/tasks`)

#### 1. Роль: `ROLE_USER` (например, user1/password - user1)

| Эндпоинт                                     | Действие                                | Ожидаемый результат (Статус) | Примечание                                         |
|:---------------------------------------------|:----------------------------------------|:-----------------------------|:---------------------------------------------------|
| **`GET /tasks`**                             | **(Позитивный)** Получение всех задач   | `200 OK`                     |                                                    |
| **`GET /tasks/{id}`**                        | **(Позитивный)** Получение задачи по ID | `200 OK`                     | Использовать существующий ID задачи                |
| **`POST /tasks`**                            | **(Негативный)** Создание задачи        | `403 Forbidden`              |                                                    |
| **`PUT /tasks/{id}`**                        | **(Негативный)** Обновление задачи      | `403 Forbidden`              |                                                    |
| **`DELETE /tasks/{id}`**                     | **(Негативный)** Удаление задачи        | `403 Forbidden`              |                                                    |
| **`POST /tasks/{id}/observer/{observerId}`** | **(Позитивный)** Добавление наблюдателя | `200 OK`                     | Использовать существующие ID задачи и пользователя |
| **`POST /tasks/{id}/assignee/{assigneeId}`** | **(Негативный)** Назначение исполнителя | `403 Forbidden`              |                                                    |

---

#### 2. Роль: `ROLE_MANAGER` (manager/password - manager)

| Эндпоинт                                     | Действие                                | Ожидаемый результат (Статус) | Примечание                                         |
|:---------------------------------------------|:----------------------------------------|:-----------------------------|:---------------------------------------------------|
| **`GET /tasks`**                             | **(Позитивный)** Получение всех задач   | `200 OK`                     |                                                    |
| **`GET /tasks/{id}`**                        | **(Позитивный)** Получение задачи по ID | `200 OK`                     | Использовать существующий ID задачи                |
| **`POST /tasks`**                            | **(Позитивный)** Создание задачи        | `201 Created`                |                                                    |
| **`PUT /tasks/{id}`**                        | **(Позитивный)** Обновление задачи      | `200 OK`                     |                                                    |
| **`DELETE /tasks/{id}`**                     | **(Позитивный)** Удаление задачи        | `204 No Content`             |                                                    |
| **`POST /tasks/{id}/observer/{observerId}`** | **(Позитивный)** Добавление наблюдателя | `200 OK`                     | Использовать существующие ID задачи и пользователя |
| **`POST /tasks/{id}/assignee/{assigneeId}`** | **(Позитивный)** Назначение исполнителя | `200 OK`                     | Использовать существующие ID задачи и пользователя |

---

### Сценарии тестирования для `UserController` (`/users`)

#### 1. Роль: `ROLE_USER` (например, user1/password-user1)

| Эндпоинт                 | Действие                                              | Ожидаемый результат (Статус) | Примечание                                                               |
|:-------------------------|:------------------------------------------------------|:-----------------------------|:-------------------------------------------------------------------------|
| **`GET /users`**         | **(Позитивный)** Получение всех пользователей         | `200 OK`                     | Доступ к эндпоинту разрешен согласно ТЗ.                                 |
| **`GET /users/{id}`**    | **(Позитивный)** Получение данных любого пользователя | `200 OK`                     | Доступ к эндпоинту разрешен согласно ТЗ.                                 |
| **`POST /users`**        | **(Негативный)** Создание пользователя                | `403 Forbidden`              | Эндпоинт доступен только для `ROLE_MANAGER`.                             |
| **`PUT /users/{id}`**    | **(Позитивный)** Обновление **своих** данных          | `200 OK`                     | Использовать ID пользователя `user1`.                                    |
| **`PUT /users/{id}`**    | **(Негативный)** Обновление **чужих** данных          | `403 Forbidden`              | Использовать ID пользователя `user2`. Логика сервиса запрещает действие. |
| **`DELETE /users/{id}`** | **(Позитивный)** Удаление **своего** профиля          | `204 No Content`             | Использовать ID пользователя `user1`.                                    |
| **`DELETE /users/{id}`** | **(Негативный)** Удаление **чужого** профиля          | `403 Forbidden`              | Использовать ID пользователя `user2`. Логика сервиса запрещает действие. |

---

#### 2. Роль: `ROLE_MANAGER` (manager/password - manager)

| Эндпоинт                 | Действие                                               | Ожидаемый результат (Статус) | Примечание                            |
|:-------------------------|:-------------------------------------------------------|:-----------------------------|:--------------------------------------|
| **`GET /users`**         | **(Позитивный)** Получение всех пользователей          | `200 OK`                     |                                       |
| **`GET /users/{id}`**    | **(Позитивный)** Получение данных любого пользователя  | `200 OK`                     | Использовать ID пользователя `user2`. |
| **`POST /users`**        | **(Позитивный)** Создание пользователя                 | `201 Created`                |                                       |
| **`PUT /users/{id}`**    | **(Позитивный)** Обновление данных любого пользователя | `200 OK`                     | Использовать ID пользователя `user2`. |
| **`DELETE /users/{id}`** | **(Позитивный)** Удаление любого пользователя          | `204 No Content`             | Использовать ID пользователя `user2`. |

---
